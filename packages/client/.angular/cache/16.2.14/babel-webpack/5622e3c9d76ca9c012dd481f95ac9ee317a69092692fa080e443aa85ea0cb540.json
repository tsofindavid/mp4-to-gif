{"ast":null,"code":"import _asyncToGenerator from \"/Users/David/Documents/own_projects/mp4-to-gif/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl, extractOperations, extractUuid } from '../../../utils/cdn-utils.js';\nimport { TRANSPARENT_PIXEL_SRC } from '../../../utils/transparentPixelSrc.js';\nimport { ShadowWrapper } from '../../ShadowWrapper/ShadowWrapper.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { operationsToTransformations, transformationsToOperations } from './lib/transformationUtils.js';\nimport { initState } from './state.js';\nimport { TEMPLATE } from './template.js';\nimport { TabId } from './toolbar-constants.js';\nexport class CloudEditor extends ShadowWrapper {\n  pauseRender = true;\n  get ctxName() {\n    return this.autoCtxName;\n  }\n  init$ = {\n    ...this.init$,\n    ...initState(this)\n  };\n\n  /** @private */\n  _debouncedShowLoader = debounce(this._showLoader.bind(this), 300);\n  _showLoader(show) {\n    this.$.showLoader = show;\n  }\n\n  /**\n   * To proper work, we need non-zero size the element. So, we'll wait for it.\n   *\n   * @private\n   * @returns {Promise<void>}\n   */\n  _waitForSize() {\n    const TIMEOUT = 3000;\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        reject(new Error('[cloud-image-editor] timeout waiting for non-zero container size'));\n      }, TIMEOUT);\n      const resizeObserver = new ResizeObserver(([element]) => {\n        if (element.contentRect.width > 0 && element.contentRect.height > 0) {\n          resolve();\n          clearTimeout(timeoutId);\n          resizeObserver.disconnect();\n        }\n      });\n      resizeObserver.observe(this);\n    });\n  }\n  cssInit$ = {\n    ...this.cssInit$,\n    '--cfg-cdn-cname': 'https://ucarecdn.com'\n  };\n  shadowReadyCallback() {\n    if (this.renderShadow) {\n      this.initEditor();\n    }\n  }\n  initCallback() {\n    super.initCallback();\n    this.$['*faderEl'] = this.ref['fader-el'];\n    this.$['*cropperEl'] = this.ref['cropper-el'];\n    this.$['*imgContainerEl'] = this.ref['img-container-el'];\n    if (!this.renderShadow) {\n      this.initEditor();\n    }\n  }\n  initEditor() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this._waitForSize();\n      } catch (err) {\n        if (_this.isConnected) {\n          console.error(err.message);\n        }\n        return;\n      }\n      _this.ref['img-el'].addEventListener('load', e => {\n        _this._imgLoading = false;\n        _this._debouncedShowLoader(false);\n        if (_this.$.src !== TRANSPARENT_PIXEL_SRC) {\n          _this.$['*networkProblems'] = false;\n        }\n      });\n      _this.ref['img-el'].addEventListener('error', e => {\n        _this._imgLoading = false;\n        _this._debouncedShowLoader(false);\n        _this.$['*networkProblems'] = true;\n      });\n      _this.sub('src', src => {\n        let el = _this.ref['img-el'];\n        if (el.src !== src) {\n          _this._imgLoading = true;\n          el.src = src || TRANSPARENT_PIXEL_SRC;\n        }\n      });\n      _this.sub('*tabId', tabId => {\n        _this.ref['img-el'].className = classNames('image', {\n          image_hidden_to_cropper: tabId === TabId.CROP,\n          image_hidden_effects: tabId !== TabId.CROP\n        });\n      });\n      if (_this.$.cdnUrl) {\n        let uuid = extractUuid(_this.$.cdnUrl);\n        _this.$['*originalUrl'] = createOriginalUrl(_this.$.cdnUrl, uuid);\n        let operations = extractOperations(_this.$.cdnUrl);\n        let transformations = operationsToTransformations(operations);\n        _this.$['*editorTransformations'] = transformations;\n      } else if (_this.$.uuid) {\n        _this.$['*originalUrl'] = createOriginalUrl(_this.localCtx.read('--cfg-cdn-cname'), _this.$.uuid);\n      } else {\n        throw new Error('No UUID nor CDN URL provided');\n      }\n      _this.classList.add('editor_ON');\n      _this.sub('*networkProblems', networkProblems => {\n        _this.$['presence.networkProblems'] = networkProblems;\n        _this.$['presence.modalCaption'] = !networkProblems;\n      });\n      _this.sub('*editorTransformations', transformations => {\n        let originalUrl = _this.$['*originalUrl'];\n        let cdnUrlModifiers = createCdnUrlModifiers(transformationsToOperations(transformations));\n        let cdnUrl = createCdnUrl(originalUrl, createCdnUrlModifiers(cdnUrlModifiers, 'preview'));\n\n        /** @type {import('./types.js').ApplyResult} */\n        let eventData = {\n          originalUrl,\n          cdnUrlModifiers,\n          cdnUrl,\n          transformations\n        };\n        _this.dispatchEvent(new CustomEvent('change', {\n          detail: eventData,\n          bubbles: true,\n          composed: true\n        }));\n      }, false);\n      try {\n        fetch(createCdnUrl(_this.$['*originalUrl'], createCdnUrlModifiers('json'))).then(response => response.json()).then(({\n          width,\n          height\n        }) => {\n          _this.$['*imageSize'] = {\n            width,\n            height\n          };\n        });\n      } catch (err) {\n        if (err) {\n          console.error('Failed to load image info', err);\n        }\n      }\n    })();\n  }\n}\nCloudEditor.template = TEMPLATE;\nCloudEditor.bindAttributes({\n  uuid: 'uuid',\n  'cdn-url': 'cdnUrl'\n});","map":{"version":3,"names":["createCdnUrl","createCdnUrlModifiers","createOriginalUrl","extractOperations","extractUuid","TRANSPARENT_PIXEL_SRC","ShadowWrapper","classNames","debounce","operationsToTransformations","transformationsToOperations","initState","TEMPLATE","TabId","CloudEditor","pauseRender","ctxName","autoCtxName","init$","_debouncedShowLoader","_showLoader","bind","show","$","showLoader","_waitForSize","TIMEOUT","Promise","resolve","reject","timeoutId","setTimeout","Error","resizeObserver","ResizeObserver","element","contentRect","width","height","clearTimeout","disconnect","observe","cssInit$","shadowReadyCallback","renderShadow","initEditor","initCallback","ref","_this","_asyncToGenerator","err","isConnected","console","error","message","addEventListener","e","_imgLoading","src","sub","el","tabId","className","image_hidden_to_cropper","CROP","image_hidden_effects","cdnUrl","uuid","operations","transformations","localCtx","read","classList","add","networkProblems","originalUrl","cdnUrlModifiers","eventData","dispatchEvent","CustomEvent","detail","bubbles","composed","fetch","then","response","json","template","bindAttributes"],"sources":["/Users/David/Documents/own_projects/mp4-to-gif/node_modules/@uploadcare/blocks/blocks/CloudImageEditor/src/CloudEditor.js"],"sourcesContent":["import {\n  createCdnUrl,\n  createCdnUrlModifiers,\n  createOriginalUrl,\n  extractOperations,\n  extractUuid,\n} from '../../../utils/cdn-utils.js';\nimport { TRANSPARENT_PIXEL_SRC } from '../../../utils/transparentPixelSrc.js';\nimport { ShadowWrapper } from '../../ShadowWrapper/ShadowWrapper.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { operationsToTransformations, transformationsToOperations } from './lib/transformationUtils.js';\nimport { initState } from './state.js';\nimport { TEMPLATE } from './template.js';\nimport { TabId } from './toolbar-constants.js';\n\nexport class CloudEditor extends ShadowWrapper {\n  pauseRender = true;\n\n  get ctxName() {\n    return this.autoCtxName;\n  }\n\n  init$ = {\n    ...this.init$,\n    ...initState(this),\n  };\n\n  /** @private */\n  _debouncedShowLoader = debounce(this._showLoader.bind(this), 300);\n\n  _showLoader(show) {\n    this.$.showLoader = show;\n  }\n\n  /**\n   * To proper work, we need non-zero size the element. So, we'll wait for it.\n   *\n   * @private\n   * @returns {Promise<void>}\n   */\n  _waitForSize() {\n    const TIMEOUT = 3000;\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        reject(new Error('[cloud-image-editor] timeout waiting for non-zero container size'));\n      }, TIMEOUT);\n      const resizeObserver = new ResizeObserver(([element]) => {\n        if (element.contentRect.width > 0 && element.contentRect.height > 0) {\n          resolve();\n          clearTimeout(timeoutId);\n          resizeObserver.disconnect();\n        }\n      });\n      resizeObserver.observe(this);\n    });\n  }\n\n  cssInit$ = {\n    ...this.cssInit$,\n    '--cfg-cdn-cname': 'https://ucarecdn.com',\n  };\n\n  shadowReadyCallback() {\n    if (this.renderShadow) {\n      this.initEditor();\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.$['*faderEl'] = this.ref['fader-el'];\n    this.$['*cropperEl'] = this.ref['cropper-el'];\n    this.$['*imgContainerEl'] = this.ref['img-container-el'];\n\n    if (!this.renderShadow) {\n      this.initEditor();\n    }\n  }\n\n  async initEditor() {\n    try {\n      await this._waitForSize();\n    } catch (err) {\n      if (this.isConnected) {\n        console.error(err.message);\n      }\n      return;\n    }\n\n    this.ref['img-el'].addEventListener('load', (e) => {\n      this._imgLoading = false;\n      this._debouncedShowLoader(false);\n\n      if (this.$.src !== TRANSPARENT_PIXEL_SRC) {\n        this.$['*networkProblems'] = false;\n      }\n    });\n\n    this.ref['img-el'].addEventListener('error', (e) => {\n      this._imgLoading = false;\n      this._debouncedShowLoader(false);\n\n      this.$['*networkProblems'] = true;\n    });\n\n    this.sub('src', (src) => {\n      let el = this.ref['img-el'];\n      if (el.src !== src) {\n        this._imgLoading = true;\n        el.src = src || TRANSPARENT_PIXEL_SRC;\n      }\n    });\n\n    this.sub('*tabId', (tabId) => {\n      this.ref['img-el'].className = classNames('image', {\n        image_hidden_to_cropper: tabId === TabId.CROP,\n        image_hidden_effects: tabId !== TabId.CROP,\n      });\n    });\n\n    if (this.$.cdnUrl) {\n      let uuid = extractUuid(this.$.cdnUrl);\n      this.$['*originalUrl'] = createOriginalUrl(this.$.cdnUrl, uuid);\n      let operations = extractOperations(this.$.cdnUrl);\n      let transformations = operationsToTransformations(operations);\n      this.$['*editorTransformations'] = transformations;\n    } else if (this.$.uuid) {\n      this.$['*originalUrl'] = createOriginalUrl(this.localCtx.read('--cfg-cdn-cname'), this.$.uuid);\n    } else {\n      throw new Error('No UUID nor CDN URL provided');\n    }\n\n    this.classList.add('editor_ON');\n\n    this.sub('*networkProblems', (networkProblems) => {\n      this.$['presence.networkProblems'] = networkProblems;\n      this.$['presence.modalCaption'] = !networkProblems;\n    });\n\n    this.sub(\n      '*editorTransformations',\n      (transformations) => {\n        let originalUrl = this.$['*originalUrl'];\n        let cdnUrlModifiers = createCdnUrlModifiers(transformationsToOperations(transformations));\n        let cdnUrl = createCdnUrl(originalUrl, createCdnUrlModifiers(cdnUrlModifiers, 'preview'));\n\n        /** @type {import('./types.js').ApplyResult} */\n        let eventData = {\n          originalUrl,\n          cdnUrlModifiers,\n          cdnUrl,\n          transformations,\n        };\n        this.dispatchEvent(\n          new CustomEvent('change', {\n            detail: eventData,\n            bubbles: true,\n            composed: true,\n          })\n        );\n      },\n      false\n    );\n\n    try {\n      fetch(createCdnUrl(this.$['*originalUrl'], createCdnUrlModifiers('json')))\n        .then((response) => response.json())\n        .then(({ width, height }) => {\n          this.$['*imageSize'] = { width, height };\n        });\n    } catch (err) {\n      if (err) {\n        console.error('Failed to load image info', err);\n      }\n    }\n  }\n}\n\nCloudEditor.template = TEMPLATE;\nCloudEditor.bindAttributes({\n  uuid: 'uuid',\n  'cdn-url': 'cdnUrl',\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}