{"ast":null,"code":"import { BaseComponent } from '@symbiotejs/symbiote';\nimport { createWindowHeightTracker, getIsWindowHeightTracked } from '../utils/createWindowHeightTracker.js';\nimport { applyTemplateData, getPluralObjects } from '../utils/template-utils.js';\nimport { blockCtx } from './CTX.js';\nimport { l10nProcessor } from './l10nProcessor.js';\nconst TAG_PREFIX = 'lr-';\nexport class Block extends BaseComponent {\n  /** @type {string | null} */\n  static StateConsumerScope = null;\n  allowCustomTemplate = true;\n  init$ = blockCtx();\n\n  /**\n   * @param {String} str\n   * @param {{ [key: string]: string | number }} variables\n   * @returns {String}\n   */\n  l10n(str, variables = {}) {\n    if (!str) {\n      return '';\n    }\n    let template = this.getCssData('--l10n-' + str, true) || str;\n    let pluralObjects = getPluralObjects(template);\n    for (let pluralObject of pluralObjects) {\n      variables[pluralObject.variable] = this.pluralize(pluralObject.pluralKey, Number(variables[pluralObject.countVariable]));\n    }\n    let result = applyTemplateData(template, variables);\n    return result;\n  }\n\n  /**\n   * @param {string} key\n   * @param {number} count\n   * @returns {string}\n   */\n  pluralize(key, count) {\n    const locale = this.l10n('locale-name') || 'en-US';\n    const pluralForm = new Intl.PluralRules(locale).select(count);\n    return this.l10n(`${key}__${pluralForm}`);\n  }\n  constructor() {\n    super();\n    /** @type {String} */\n    this.activityType = null;\n    this.addTemplateProcessor(l10nProcessor);\n    // TODO: inspect template on lr-* elements\n    // this.addTemplateProcessor((fr) => {\n    //   [...fr.querySelectorAll('*')].forEach((el) => {\n    //     if (el.tagName.includes('LR-')) {\n    //       let tag = el.tagName.toLowerCase();\n    //       console.log(window.customElements.get(tag)?.name);\n    //     }\n    //   });\n    // });\n    /**\n     * @private\n     * @type {String[]}\n     */\n    this.__l10nKeys = [];\n  }\n\n  /**\n   * @param {String} localPropKey\n   * @param {String} l10nKey\n   */\n  applyL10nKey(localPropKey, l10nKey) {\n    let prop = 'l10n:' + localPropKey;\n    this.$[prop] = /** @type {any} */l10nKey;\n    this.__l10nKeys.push(localPropKey);\n  }\n\n  /**\n   * @param {(block: Block) => boolean} callback\n   * @returns {Boolean}\n   */\n  findBlockInCtx(callback) {\n    /** @type {Set} */\n    let blocksRegistry = this.$['*blocksRegistry'];\n    for (let block of blocksRegistry) {\n      if (callback(block)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * @param {String} consumerScope\n   * @param {String} prop\n   * @param {any} newVal\n   */\n  setForCtxTarget(consumerScope, prop, newVal) {\n    if (this.findBlockInCtx(b => /** @type {typeof Block} */b.constructor.StateConsumerScope === consumerScope)) {\n      this.$[prop] = newVal;\n    }\n  }\n\n  /** @param {String} activityType */\n  setActivity(activityType) {\n    if (this.findBlockInCtx(b => b.activityType === activityType)) {\n      this.$['*currentActivity'] = activityType;\n      return;\n    }\n    console.warn(`Activity type \"${activityType}\" not found in the context`);\n  }\n  connectedCallback() {\n    if (!getIsWindowHeightTracked()) {\n      this._destroyInnerHeightTracker = createWindowHeightTracker();\n    }\n    if (this.hasAttribute('retpl')) {\n      this.constructor['template'] = null;\n      this.processInnerHtml = true;\n    }\n    super.connectedCallback();\n  }\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._destroyInnerHeightTracker?.();\n  }\n  initCallback() {\n    let blocksRegistry = this.$['*blocksRegistry'];\n    blocksRegistry.add(this);\n  }\n  destroyCallback() {\n    let blocksRegistry = this.$['*blocksRegistry'];\n    blocksRegistry.delete(this);\n  }\n\n  /**\n   * @param {Number} bytes\n   * @param {Number} [decimals]\n   */\n  fileSizeFmt(bytes, decimals = 2) {\n    let units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    /**\n     * @param {String} str\n     * @returns {String}\n     */\n    let getUnit = str => {\n      return this.getCssData('--l10n-unit-' + str.toLowerCase(), true) || str;\n    };\n    if (bytes === 0) {\n      return `0 ${getUnit(units[0])}`;\n    }\n    let k = 1024;\n    let dm = decimals < 0 ? 0 : decimals;\n    let i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / k ** i).toFixed(dm)) + ' ' + getUnit(units[i]);\n  }\n\n  /**\n   * @param {String} url\n   * @returns {String}\n   */\n  proxyUrl(url) {\n    let previewProxy = this.getCssData('--cfg-secure-delivery-proxy', true);\n    if (!previewProxy) {\n      return url;\n    }\n    return applyTemplateData(previewProxy, {\n      previewUrl: url\n    }, {\n      transform: value => window.encodeURIComponent(value)\n    });\n  }\n  updateCtxCssData = () => {\n    /** @type {Set<Block>} */\n    let blocks = this.$['*blocksRegistry'];\n    for (let block of blocks) {\n      if (block.isConnected) {\n        block.updateCssData();\n      }\n    }\n  };\n\n  /** @param {String} [name] */\n  static reg(name) {\n    if (!name) {\n      super.reg();\n      return;\n    }\n    super.reg(name.startsWith(TAG_PREFIX) ? name : TAG_PREFIX + name);\n  }\n}\nexport { BaseComponent };","map":{"version":3,"names":["BaseComponent","createWindowHeightTracker","getIsWindowHeightTracked","applyTemplateData","getPluralObjects","blockCtx","l10nProcessor","TAG_PREFIX","Block","StateConsumerScope","allowCustomTemplate","init$","l10n","str","variables","template","getCssData","pluralObjects","pluralObject","variable","pluralize","pluralKey","Number","countVariable","result","key","count","locale","pluralForm","Intl","PluralRules","select","constructor","activityType","addTemplateProcessor","__l10nKeys","applyL10nKey","localPropKey","l10nKey","prop","$","push","findBlockInCtx","callback","blocksRegistry","block","setForCtxTarget","consumerScope","newVal","b","setActivity","console","warn","connectedCallback","_destroyInnerHeightTracker","hasAttribute","processInnerHtml","disconnectedCallback","initCallback","add","destroyCallback","delete","fileSizeFmt","bytes","decimals","units","getUnit","toLowerCase","k","dm","i","Math","floor","log","parseFloat","toFixed","proxyUrl","url","previewProxy","previewUrl","transform","value","window","encodeURIComponent","updateCtxCssData","blocks","isConnected","updateCssData","reg","name","startsWith"],"sources":["/Users/David/Documents/own_projects/mp4-to-gif/node_modules/@uploadcare/blocks/abstract/Block.js"],"sourcesContent":["import { BaseComponent } from '@symbiotejs/symbiote';\nimport { createWindowHeightTracker, getIsWindowHeightTracked } from '../utils/createWindowHeightTracker.js';\nimport { applyTemplateData, getPluralObjects } from '../utils/template-utils.js';\nimport { blockCtx } from './CTX.js';\nimport { l10nProcessor } from './l10nProcessor.js';\n\nconst TAG_PREFIX = 'lr-';\n\nexport class Block extends BaseComponent {\n  /** @type {string | null} */\n  static StateConsumerScope = null;\n  allowCustomTemplate = true;\n\n  init$ = blockCtx();\n\n  /**\n   * @param {String} str\n   * @param {{ [key: string]: string | number }} variables\n   * @returns {String}\n   */\n  l10n(str, variables = {}) {\n    if (!str) {\n      return '';\n    }\n    let template = this.getCssData('--l10n-' + str, true) || str;\n    let pluralObjects = getPluralObjects(template);\n    for (let pluralObject of pluralObjects) {\n      variables[pluralObject.variable] = this.pluralize(\n        pluralObject.pluralKey,\n        Number(variables[pluralObject.countVariable])\n      );\n    }\n    let result = applyTemplateData(template, variables);\n    return result;\n  }\n\n  /**\n   * @param {string} key\n   * @param {number} count\n   * @returns {string}\n   */\n  pluralize(key, count) {\n    const locale = this.l10n('locale-name') || 'en-US';\n    const pluralForm = new Intl.PluralRules(locale).select(count);\n    return this.l10n(`${key}__${pluralForm}`);\n  }\n\n  constructor() {\n    super();\n    /** @type {String} */\n    this.activityType = null;\n    this.addTemplateProcessor(l10nProcessor);\n    // TODO: inspect template on lr-* elements\n    // this.addTemplateProcessor((fr) => {\n    //   [...fr.querySelectorAll('*')].forEach((el) => {\n    //     if (el.tagName.includes('LR-')) {\n    //       let tag = el.tagName.toLowerCase();\n    //       console.log(window.customElements.get(tag)?.name);\n    //     }\n    //   });\n    // });\n    /**\n     * @private\n     * @type {String[]}\n     */\n    this.__l10nKeys = [];\n  }\n\n  /**\n   * @param {String} localPropKey\n   * @param {String} l10nKey\n   */\n  applyL10nKey(localPropKey, l10nKey) {\n    let prop = 'l10n:' + localPropKey;\n    this.$[prop] = /** @type {any} */ (l10nKey);\n    this.__l10nKeys.push(localPropKey);\n  }\n\n  /**\n   * @param {(block: Block) => boolean} callback\n   * @returns {Boolean}\n   */\n  findBlockInCtx(callback) {\n    /** @type {Set} */\n    let blocksRegistry = this.$['*blocksRegistry'];\n    for (let block of blocksRegistry) {\n      if (callback(block)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * @param {String} consumerScope\n   * @param {String} prop\n   * @param {any} newVal\n   */\n  setForCtxTarget(consumerScope, prop, newVal) {\n    if (this.findBlockInCtx((b) => /** @type {typeof Block} */ (b.constructor).StateConsumerScope === consumerScope)) {\n      this.$[prop] = newVal;\n    }\n  }\n\n  /** @param {String} activityType */\n  setActivity(activityType) {\n    if (this.findBlockInCtx((b) => b.activityType === activityType)) {\n      this.$['*currentActivity'] = activityType;\n      return;\n    }\n    console.warn(`Activity type \"${activityType}\" not found in the context`);\n  }\n\n  connectedCallback() {\n    if (!getIsWindowHeightTracked()) {\n      this._destroyInnerHeightTracker = createWindowHeightTracker();\n    }\n    if (this.hasAttribute('retpl')) {\n      this.constructor['template'] = null;\n      this.processInnerHtml = true;\n    }\n    super.connectedCallback();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._destroyInnerHeightTracker?.();\n  }\n\n  initCallback() {\n    let blocksRegistry = this.$['*blocksRegistry'];\n    blocksRegistry.add(this);\n  }\n\n  destroyCallback() {\n    let blocksRegistry = this.$['*blocksRegistry'];\n    blocksRegistry.delete(this);\n  }\n\n  /**\n   * @param {Number} bytes\n   * @param {Number} [decimals]\n   */\n  fileSizeFmt(bytes, decimals = 2) {\n    let units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    /**\n     * @param {String} str\n     * @returns {String}\n     */\n    let getUnit = (str) => {\n      return this.getCssData('--l10n-unit-' + str.toLowerCase(), true) || str;\n    };\n    if (bytes === 0) {\n      return `0 ${getUnit(units[0])}`;\n    }\n    let k = 1024;\n    let dm = decimals < 0 ? 0 : decimals;\n    let i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / k ** i).toFixed(dm)) + ' ' + getUnit(units[i]);\n  }\n\n  /**\n   * @param {String} url\n   * @returns {String}\n   */\n  proxyUrl(url) {\n    let previewProxy = this.getCssData('--cfg-secure-delivery-proxy', true);\n    if (!previewProxy) {\n      return url;\n    }\n    return applyTemplateData(\n      previewProxy,\n      { previewUrl: url },\n      { transform: (value) => window.encodeURIComponent(value) }\n    );\n  }\n\n  updateCtxCssData = () => {\n    /** @type {Set<Block>} */\n    let blocks = this.$['*blocksRegistry'];\n    for (let block of blocks) {\n      if (block.isConnected) {\n        block.updateCssData();\n      }\n    }\n  };\n\n  /** @param {String} [name] */\n  static reg(name) {\n    if (!name) {\n      super.reg();\n      return;\n    }\n    super.reg(name.startsWith(TAG_PREFIX) ? name : TAG_PREFIX + name);\n  }\n}\n\nexport { BaseComponent };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}