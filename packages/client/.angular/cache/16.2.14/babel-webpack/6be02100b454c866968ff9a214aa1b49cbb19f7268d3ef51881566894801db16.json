{"ast":null,"code":"import _asyncToGenerator from \"/Users/David/Documents/own_projects/mp4-to-gif/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { getDropItems } from './getDropItems.js';\n\n/** @enum {Number} */\nexport const DropzoneState = {\n  ACTIVE: 0,\n  INACTIVE: 1,\n  NEAR: 2,\n  OVER: 3\n};\nlet RESET_EVENTS = ['focus'];\nlet NEAR_OFFSET = 100;\nlet nearnessRegistry = new Map();\n\n/**\n * @param {[x: number, y: number]} p\n * @param {{ x: number; y: number; width: number; height: number }} r\n * @returns {number}\n */\nfunction distance(p, r) {\n  let cx = Math.max(Math.min(p[0], r.x + r.width), r.x);\n  let cy = Math.max(Math.min(p[1], r.y + r.height), r.y);\n  return Math.sqrt((p[0] - cx) * (p[0] - cx) + (p[1] - cy) * (p[1] - cy));\n}\n\n/**\n * @param {Object} desc\n * @param {HTMLElement} desc.element\n * @param {Function} desc.onChange\n * @param {Function} desc.onItems\n * @param {() => Boolean} desc.shouldIgnore\n */\nexport function addDropzone(desc) {\n  let eventCounter = 0;\n  let body = document.body;\n  let switchHandlers = new Set();\n  let handleSwitch = fn => switchHandlers.add(fn);\n  let state = DropzoneState.INACTIVE;\n  let setState = newState => {\n    if (desc.shouldIgnore() && newState !== DropzoneState.INACTIVE) {\n      return;\n    }\n    if (state !== newState) {\n      switchHandlers.forEach(fn => fn(newState));\n    }\n    state = newState;\n  };\n  let isDragging = () => eventCounter > 0;\n  handleSwitch(newState => desc.onChange(newState));\n  let onResetEvent = () => {\n    eventCounter = 0;\n    setState(DropzoneState.INACTIVE);\n  };\n  let onDragEnter = () => {\n    eventCounter += 1;\n    if (state === DropzoneState.INACTIVE) {\n      setState(DropzoneState.ACTIVE);\n    }\n  };\n  let onDragLeave = () => {\n    eventCounter -= 1;\n    if (!isDragging()) {\n      setState(DropzoneState.INACTIVE);\n    }\n  };\n  let onDrop = e => {\n    e.preventDefault();\n    eventCounter = 0;\n    setState(DropzoneState.INACTIVE);\n  };\n  let onDragOver = e => {\n    if (!isDragging()) {\n      eventCounter += 1;\n    }\n    e.preventDefault();\n\n    /** @type {[Number, Number]} */\n    let dragPoint = [e.x, e.y];\n    let targetRect = desc.element.getBoundingClientRect();\n    let nearness = Math.floor(distance(dragPoint, targetRect));\n    let isNear = nearness < NEAR_OFFSET;\n    let isOver = e.composedPath().includes(desc.element);\n    nearnessRegistry.set(desc.element, nearness);\n    let isNearest = Math.min(...nearnessRegistry.values()) === nearness;\n    if (isOver && isNearest) {\n      setState(DropzoneState.OVER);\n    } else if (isNear && isNearest) {\n      setState(DropzoneState.NEAR);\n    } else {\n      setState(DropzoneState.ACTIVE);\n    }\n  };\n  let onElementDrop = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(function* (e) {\n      if (desc.shouldIgnore()) {\n        return;\n      }\n      e.preventDefault();\n      let items = yield getDropItems(e.dataTransfer);\n      desc.onItems(items);\n      setState(DropzoneState.INACTIVE);\n    });\n    return function onElementDrop(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  body.addEventListener('drop', onDrop);\n  body.addEventListener('dragleave', onDragLeave);\n  body.addEventListener('dragenter', onDragEnter);\n  body.addEventListener('dragover', onDragOver);\n  desc.element.addEventListener('drop', onElementDrop);\n  RESET_EVENTS.forEach(eventName => {\n    window.addEventListener(eventName, onResetEvent);\n  });\n  return () => {\n    nearnessRegistry.delete(desc.element);\n    body.removeEventListener('drop', onDrop);\n    body.removeEventListener('dragleave', onDragLeave);\n    body.removeEventListener('dragenter', onDragEnter);\n    body.removeEventListener('dragover', onDragOver);\n    desc.element.removeEventListener('drop', onElementDrop);\n    RESET_EVENTS.forEach(eventName => {\n      window.removeEventListener(eventName, onResetEvent);\n    });\n  };\n}","map":{"version":3,"names":["getDropItems","DropzoneState","ACTIVE","INACTIVE","NEAR","OVER","RESET_EVENTS","NEAR_OFFSET","nearnessRegistry","Map","distance","p","r","cx","Math","max","min","x","width","cy","y","height","sqrt","addDropzone","desc","eventCounter","body","document","switchHandlers","Set","handleSwitch","fn","add","state","setState","newState","shouldIgnore","forEach","isDragging","onChange","onResetEvent","onDragEnter","onDragLeave","onDrop","e","preventDefault","onDragOver","dragPoint","targetRect","element","getBoundingClientRect","nearness","floor","isNear","isOver","composedPath","includes","set","isNearest","values","onElementDrop","_ref","_asyncToGenerator","items","dataTransfer","onItems","_x","apply","arguments","addEventListener","eventName","window","delete","removeEventListener"],"sources":["/Users/David/Documents/own_projects/mp4-to-gif/node_modules/@uploadcare/blocks/blocks/DropArea/addDropzone.js"],"sourcesContent":["import { getDropItems } from './getDropItems.js';\n\n/** @enum {Number} */\nexport const DropzoneState = {\n  ACTIVE: 0,\n  INACTIVE: 1,\n  NEAR: 2,\n  OVER: 3,\n};\n\nlet RESET_EVENTS = ['focus'];\nlet NEAR_OFFSET = 100;\nlet nearnessRegistry = new Map();\n\n/**\n * @param {[x: number, y: number]} p\n * @param {{ x: number; y: number; width: number; height: number }} r\n * @returns {number}\n */\nfunction distance(p, r) {\n  let cx = Math.max(Math.min(p[0], r.x + r.width), r.x);\n  let cy = Math.max(Math.min(p[1], r.y + r.height), r.y);\n\n  return Math.sqrt((p[0] - cx) * (p[0] - cx) + (p[1] - cy) * (p[1] - cy));\n}\n\n/**\n * @param {Object} desc\n * @param {HTMLElement} desc.element\n * @param {Function} desc.onChange\n * @param {Function} desc.onItems\n * @param {() => Boolean} desc.shouldIgnore\n */\nexport function addDropzone(desc) {\n  let eventCounter = 0;\n\n  let body = document.body;\n  let switchHandlers = new Set();\n  let handleSwitch = (fn) => switchHandlers.add(fn);\n  let state = DropzoneState.INACTIVE;\n\n  let setState = (newState) => {\n    if (desc.shouldIgnore() && newState !== DropzoneState.INACTIVE) {\n      return;\n    }\n    if (state !== newState) {\n      switchHandlers.forEach((fn) => fn(newState));\n    }\n    state = newState;\n  };\n\n  let isDragging = () => eventCounter > 0;\n\n  handleSwitch((newState) => desc.onChange(newState));\n\n  let onResetEvent = () => {\n    eventCounter = 0;\n    setState(DropzoneState.INACTIVE);\n  };\n  let onDragEnter = () => {\n    eventCounter += 1;\n    if (state === DropzoneState.INACTIVE) {\n      setState(DropzoneState.ACTIVE);\n    }\n  };\n  let onDragLeave = () => {\n    eventCounter -= 1;\n    if (!isDragging()) {\n      setState(DropzoneState.INACTIVE);\n    }\n  };\n  let onDrop = (e) => {\n    e.preventDefault();\n    eventCounter = 0;\n    setState(DropzoneState.INACTIVE);\n  };\n\n  let onDragOver = (e) => {\n    if (!isDragging()) {\n      eventCounter += 1;\n    }\n    e.preventDefault();\n\n    /** @type {[Number, Number]} */\n    let dragPoint = [e.x, e.y];\n    let targetRect = desc.element.getBoundingClientRect();\n    let nearness = Math.floor(distance(dragPoint, targetRect));\n    let isNear = nearness < NEAR_OFFSET;\n    let isOver = e.composedPath().includes(desc.element);\n\n    nearnessRegistry.set(desc.element, nearness);\n    let isNearest = Math.min(...nearnessRegistry.values()) === nearness;\n\n    if (isOver && isNearest) {\n      setState(DropzoneState.OVER);\n    } else if (isNear && isNearest) {\n      setState(DropzoneState.NEAR);\n    } else {\n      setState(DropzoneState.ACTIVE);\n    }\n  };\n\n  let onElementDrop = async (e) => {\n    if (desc.shouldIgnore()) {\n      return;\n    }\n    e.preventDefault();\n    let items = await getDropItems(e.dataTransfer);\n    desc.onItems(items);\n    setState(DropzoneState.INACTIVE);\n  };\n\n  body.addEventListener('drop', onDrop);\n  body.addEventListener('dragleave', onDragLeave);\n  body.addEventListener('dragenter', onDragEnter);\n  body.addEventListener('dragover', onDragOver);\n  desc.element.addEventListener('drop', onElementDrop);\n  RESET_EVENTS.forEach((eventName) => {\n    window.addEventListener(eventName, onResetEvent);\n  });\n\n  return () => {\n    nearnessRegistry.delete(desc.element);\n    body.removeEventListener('drop', onDrop);\n    body.removeEventListener('dragleave', onDragLeave);\n    body.removeEventListener('dragenter', onDragEnter);\n    body.removeEventListener('dragover', onDragOver);\n    desc.element.removeEventListener('drop', onElementDrop);\n    RESET_EVENTS.forEach((eventName) => {\n      window.removeEventListener(eventName, onResetEvent);\n    });\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}