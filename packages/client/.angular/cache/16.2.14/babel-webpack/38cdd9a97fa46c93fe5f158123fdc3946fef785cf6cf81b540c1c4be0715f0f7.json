{"ast":null,"code":"import _asyncToGenerator from \"/Users/David/Documents/own_projects/mp4-to-gif/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { canUsePermissionsApi } from '../utils/abilities.js';\nimport { debounce } from '../utils/debounce.js';\nimport { UploadSource } from '../utils/UploadSource.js';\nexport class CameraSource extends UploaderBlock {\n  activityType = ActivityBlock.activities.CAMERA;\n\n  /** @private */\n  _unsubPermissions = null;\n  init$ = {\n    ...this.init$,\n    video: null,\n    videoTransformCss: null,\n    shotBtnDisabled: true,\n    videoHidden: true,\n    messageHidden: true,\n    requestBtnHidden: canUsePermissionsApi(),\n    l10nMessage: null,\n    originalErrorMessage: null,\n    cameraSelectOptions: null,\n    cameraSelectHidden: true,\n    onCameraSelectChange: e => {\n      /** @type {String} */\n      this._selectedCameraId = e.target.value;\n      this._capture();\n    },\n    onCancel: () => {\n      this.historyBack();\n    },\n    onShot: () => {\n      this._shot();\n    },\n    onRequestPermissions: () => {\n      this._capture();\n    }\n  };\n  cssInit$ = {\n    ...this.cssInit$,\n    '--cfg-camera-mirror': 1\n  };\n\n  /** @private */\n  _onActivate = () => {\n    if (canUsePermissionsApi()) {\n      this._subscribePermissions();\n    }\n    this._capture();\n  };\n\n  /** @private */\n  _onDeactivate = () => {\n    if (this._unsubPermissions) {\n      this._unsubPermissions();\n    }\n    this._stopCapture();\n  };\n\n  /** @private */\n  _handlePermissionsChange = () => {\n    this._capture();\n  };\n\n  /**\n   * @private\n   * @param {'granted' | 'denied' | 'prompt'} state\n   */\n  _setPermissionsState = debounce(state => {\n    this.$.originalErrorMessage = null;\n    this.classList.toggle('initialized', state === 'granted');\n    if (state === 'granted') {\n      this.set$({\n        videoHidden: false,\n        shotBtnDisabled: false,\n        messageHidden: true\n      });\n    } else if (state === 'prompt') {\n      this.$.l10nMessage = this.l10n('camera-permissions-prompt');\n      this.set$({\n        videoHidden: true,\n        shotBtnDisabled: true,\n        messageHidden: false\n      });\n      this._stopCapture();\n    } else {\n      this.$.l10nMessage = this.l10n('camera-permissions-denied');\n      this.set$({\n        videoHidden: true,\n        shotBtnDisabled: true,\n        messageHidden: false\n      });\n      this._stopCapture();\n    }\n  }, 300);\n\n  /** @private */\n  _subscribePermissions() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        // @ts-ignore\n        let permissionsResponse = yield navigator.permissions.query({\n          name: 'camera'\n        });\n        permissionsResponse.addEventListener('change', _this._handlePermissionsChange);\n      } catch (err) {\n        console.log('Failed to use permissions API. Fallback to manual request mode.', err);\n        _this._capture();\n      }\n    })();\n  }\n\n  /** @private */\n  _capture() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      let constr = {\n        video: {\n          width: {\n            ideal: 1920\n          },\n          height: {\n            ideal: 1080\n          },\n          frameRate: {\n            ideal: 30\n          }\n        },\n        audio: false\n      };\n      if (_this2._selectedCameraId) {\n        constr.video.deviceId = {\n          exact: _this2._selectedCameraId\n        };\n      }\n      /** @private */\n      _this2._canvas = document.createElement('canvas');\n      /** @private */\n      _this2._ctx = _this2._canvas.getContext('2d');\n      try {\n        _this2._setPermissionsState('prompt');\n        let stream = yield navigator.mediaDevices.getUserMedia(constr);\n        stream.addEventListener('inactive', () => {\n          _this2._setPermissionsState('denied');\n        });\n        _this2.$.video = stream;\n        /** @private */\n        _this2._capturing = true;\n        _this2._setPermissionsState('granted');\n      } catch (err) {\n        _this2._setPermissionsState('denied');\n        _this2.$.originalErrorMessage = err.message;\n      }\n    })();\n  }\n\n  /** @private */\n  _stopCapture() {\n    if (this._capturing) {\n      this.$.video?.getTracks()[0].stop();\n      this.$.video = null;\n      this._capturing = false;\n    }\n  }\n\n  /** @private */\n  _shot() {\n    this._canvas.height = this.ref.video['videoHeight'];\n    this._canvas.width = this.ref.video['videoWidth'];\n    // @ts-ignore\n    this._ctx.drawImage(this.ref.video, 0, 0);\n    let date = Date.now();\n    let name = `camera-${date}.png`;\n    this._canvas.toBlob(blob => {\n      let file = new File([blob], name, {\n        lastModified: date,\n        type: 'image/png'\n      });\n      this.addFileFromObject(file, {\n        source: UploadSource.CAMERA\n      });\n      this.set$({\n        '*currentActivity': ActivityBlock.activities.UPLOAD_LIST\n      });\n    });\n  }\n  initCallback() {\n    var _superprop_getInitCallback = () => super.initCallback,\n      _this3 = this;\n    return _asyncToGenerator(function* () {\n      _superprop_getInitCallback().call(_this3);\n      _this3.registerActivity(_this3.activityType, {\n        onActivate: _this3._onActivate,\n        onDeactivate: _this3._onDeactivate\n      });\n      _this3.sub('--cfg-camera-mirror', val => {\n        _this3.$.videoTransformCss = val ? 'scaleX(-1)' : null;\n      });\n      try {\n        let deviceList = yield navigator.mediaDevices.enumerateDevices();\n        let cameraSelectOptions = deviceList.filter(info => {\n          return info.kind === 'videoinput';\n        }).map((info, idx) => {\n          return {\n            text: info.label.trim() || `${_this3.l10n('caption-camera')} ${idx + 1}`,\n            value: info.deviceId\n          };\n        });\n        if (cameraSelectOptions.length > 1) {\n          _this3.$.cameraSelectOptions = cameraSelectOptions;\n          _this3.$.cameraSelectHidden = false;\n        }\n      } catch (err) {\n        // mediaDevices isn't available for HTTP\n        // TODO: handle this case\n      }\n    })();\n  }\n}\nCameraSource.template = /* HTML */`\n  <lr-activity-header>\n    <button type=\"button\" class=\"mini-btn\" set=\"onclick: *historyBack\">\n      <lr-icon name=\"back\"></lr-icon>\n    </button>\n    <div set=\"@hidden: !cameraSelectHidden\">\n      <lr-icon name=\"camera\"></lr-icon>\n      <span l10n=\"caption-camera\"></span>\n    </div>\n    <lr-select\n      class=\"camera-select\"\n      set=\"$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange\"\n    >\n    </lr-select>\n    <button type=\"button\" class=\"mini-btn close-btn\" set=\"onclick: *closeModal\">\n      <lr-icon name=\"close\"></lr-icon>\n    </button>\n  </lr-activity-header>\n  <div class=\"content\">\n    <video\n      autoplay\n      playsinline\n      set=\"srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden\"\n      ref=\"video\"\n    ></video>\n    <div class=\"message-box\" set=\"@hidden: messageHidden\">\n      <span>{{l10nMessage}}</span>\n      <span>{{originalErrorMessage}}</span>\n      <button\n        type=\"button\"\n        set=\"onclick: onRequestPermissions; @hidden: requestBtnHidden\"\n        l10n=\"camera-permissions-request\"\n      ></button>\n    </div>\n    <button type=\"button\" class=\"shot-btn\" set=\"onclick: onShot; @disabled: shotBtnDisabled\">\n      <lr-icon name=\"camera\"></lr-icon>\n    </button>\n  </div>\n`;","map":{"version":3,"names":["UploaderBlock","ActivityBlock","canUsePermissionsApi","debounce","UploadSource","CameraSource","activityType","activities","CAMERA","_unsubPermissions","init$","video","videoTransformCss","shotBtnDisabled","videoHidden","messageHidden","requestBtnHidden","l10nMessage","originalErrorMessage","cameraSelectOptions","cameraSelectHidden","onCameraSelectChange","e","_selectedCameraId","target","value","_capture","onCancel","historyBack","onShot","_shot","onRequestPermissions","cssInit$","_onActivate","_subscribePermissions","_onDeactivate","_stopCapture","_handlePermissionsChange","_setPermissionsState","state","$","classList","toggle","set$","l10n","_this","_asyncToGenerator","permissionsResponse","navigator","permissions","query","name","addEventListener","err","console","log","_this2","constr","width","ideal","height","frameRate","audio","deviceId","exact","_canvas","document","createElement","_ctx","getContext","stream","mediaDevices","getUserMedia","_capturing","message","getTracks","stop","ref","drawImage","date","Date","now","toBlob","blob","file","File","lastModified","type","addFileFromObject","source","UPLOAD_LIST","initCallback","_superprop_getInitCallback","_this3","call","registerActivity","onActivate","onDeactivate","sub","val","deviceList","enumerateDevices","filter","info","kind","map","idx","text","label","trim","length","template"],"sources":["/Users/David/Documents/own_projects/mp4-to-gif/node_modules/@uploadcare/blocks/blocks/CameraSource/CameraSource.js"],"sourcesContent":["import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { canUsePermissionsApi } from '../utils/abilities.js';\nimport { debounce } from '../utils/debounce.js';\nimport { UploadSource } from '../utils/UploadSource.js';\n\nexport class CameraSource extends UploaderBlock {\n  activityType = ActivityBlock.activities.CAMERA;\n\n  /** @private */\n  _unsubPermissions = null;\n\n  init$ = {\n    ...this.init$,\n    video: null,\n    videoTransformCss: null,\n    shotBtnDisabled: true,\n    videoHidden: true,\n    messageHidden: true,\n    requestBtnHidden: canUsePermissionsApi(),\n    l10nMessage: null,\n    originalErrorMessage: null,\n    cameraSelectOptions: null,\n    cameraSelectHidden: true,\n\n    onCameraSelectChange: (e) => {\n      /** @type {String} */\n      this._selectedCameraId = e.target.value;\n      this._capture();\n    },\n    onCancel: () => {\n      this.historyBack();\n    },\n    onShot: () => {\n      this._shot();\n    },\n    onRequestPermissions: () => {\n      this._capture();\n    },\n  };\n\n  cssInit$ = {\n    ...this.cssInit$,\n    '--cfg-camera-mirror': 1,\n  };\n\n  /** @private */\n  _onActivate = () => {\n    if (canUsePermissionsApi()) {\n      this._subscribePermissions();\n    }\n    this._capture();\n  };\n\n  /** @private */\n  _onDeactivate = () => {\n    if (this._unsubPermissions) {\n      this._unsubPermissions();\n    }\n\n    this._stopCapture();\n  };\n\n  /** @private */\n  _handlePermissionsChange = () => {\n    this._capture();\n  };\n\n  /**\n   * @private\n   * @param {'granted' | 'denied' | 'prompt'} state\n   */\n  _setPermissionsState = debounce((state) => {\n    this.$.originalErrorMessage = null;\n    this.classList.toggle('initialized', state === 'granted');\n\n    if (state === 'granted') {\n      this.set$({\n        videoHidden: false,\n        shotBtnDisabled: false,\n        messageHidden: true,\n      });\n    } else if (state === 'prompt') {\n      this.$.l10nMessage = this.l10n('camera-permissions-prompt');\n      this.set$({\n        videoHidden: true,\n        shotBtnDisabled: true,\n        messageHidden: false,\n      });\n      this._stopCapture();\n    } else {\n      this.$.l10nMessage = this.l10n('camera-permissions-denied');\n\n      this.set$({\n        videoHidden: true,\n        shotBtnDisabled: true,\n        messageHidden: false,\n      });\n      this._stopCapture();\n    }\n  }, 300);\n\n  /** @private */\n  async _subscribePermissions() {\n    try {\n      // @ts-ignore\n      let permissionsResponse = await navigator.permissions.query({ name: 'camera' });\n      permissionsResponse.addEventListener('change', this._handlePermissionsChange);\n    } catch (err) {\n      console.log('Failed to use permissions API. Fallback to manual request mode.', err);\n      this._capture();\n    }\n  }\n\n  /** @private */\n  async _capture() {\n    let constr = {\n      video: {\n        width: {\n          ideal: 1920,\n        },\n        height: {\n          ideal: 1080,\n        },\n        frameRate: {\n          ideal: 30,\n        },\n      },\n      audio: false,\n    };\n    if (this._selectedCameraId) {\n      constr.video.deviceId = {\n        exact: this._selectedCameraId,\n      };\n    }\n    /** @private */\n    this._canvas = document.createElement('canvas');\n    /** @private */\n    this._ctx = this._canvas.getContext('2d');\n\n    try {\n      this._setPermissionsState('prompt');\n      let stream = await navigator.mediaDevices.getUserMedia(constr);\n      stream.addEventListener('inactive', () => {\n        this._setPermissionsState('denied');\n      });\n      this.$.video = stream;\n      /** @private */\n      this._capturing = true;\n      this._setPermissionsState('granted');\n    } catch (err) {\n      this._setPermissionsState('denied');\n      this.$.originalErrorMessage = err.message;\n    }\n  }\n\n  /** @private */\n  _stopCapture() {\n    if (this._capturing) {\n      this.$.video?.getTracks()[0].stop();\n      this.$.video = null;\n      this._capturing = false;\n    }\n  }\n\n  /** @private */\n  _shot() {\n    this._canvas.height = this.ref.video['videoHeight'];\n    this._canvas.width = this.ref.video['videoWidth'];\n    // @ts-ignore\n    this._ctx.drawImage(this.ref.video, 0, 0);\n    let date = Date.now();\n    let name = `camera-${date}.png`;\n    this._canvas.toBlob((blob) => {\n      let file = new File([blob], name, {\n        lastModified: date,\n        type: 'image/png',\n      });\n      this.addFileFromObject(file, { source: UploadSource.CAMERA });\n      this.set$({\n        '*currentActivity': ActivityBlock.activities.UPLOAD_LIST,\n      });\n    });\n  }\n\n  async initCallback() {\n    super.initCallback();\n    this.registerActivity(this.activityType, {\n      onActivate: this._onActivate,\n      onDeactivate: this._onDeactivate,\n    });\n\n    this.sub('--cfg-camera-mirror', (val) => {\n      this.$.videoTransformCss = val ? 'scaleX(-1)' : null;\n    });\n\n    try {\n      let deviceList = await navigator.mediaDevices.enumerateDevices();\n      let cameraSelectOptions = deviceList\n        .filter((info) => {\n          return info.kind === 'videoinput';\n        })\n        .map((info, idx) => {\n          return {\n            text: info.label.trim() || `${this.l10n('caption-camera')} ${idx + 1}`,\n            value: info.deviceId,\n          };\n        });\n      if (cameraSelectOptions.length > 1) {\n        this.$.cameraSelectOptions = cameraSelectOptions;\n        this.$.cameraSelectHidden = false;\n      }\n    } catch (err) {\n      // mediaDevices isn't available for HTTP\n      // TODO: handle this case\n    }\n  }\n}\n\nCameraSource.template = /* HTML */ `\n  <lr-activity-header>\n    <button type=\"button\" class=\"mini-btn\" set=\"onclick: *historyBack\">\n      <lr-icon name=\"back\"></lr-icon>\n    </button>\n    <div set=\"@hidden: !cameraSelectHidden\">\n      <lr-icon name=\"camera\"></lr-icon>\n      <span l10n=\"caption-camera\"></span>\n    </div>\n    <lr-select\n      class=\"camera-select\"\n      set=\"$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange\"\n    >\n    </lr-select>\n    <button type=\"button\" class=\"mini-btn close-btn\" set=\"onclick: *closeModal\">\n      <lr-icon name=\"close\"></lr-icon>\n    </button>\n  </lr-activity-header>\n  <div class=\"content\">\n    <video\n      autoplay\n      playsinline\n      set=\"srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden\"\n      ref=\"video\"\n    ></video>\n    <div class=\"message-box\" set=\"@hidden: messageHidden\">\n      <span>{{l10nMessage}}</span>\n      <span>{{originalErrorMessage}}</span>\n      <button\n        type=\"button\"\n        set=\"onclick: onRequestPermissions; @hidden: requestBtnHidden\"\n        l10n=\"camera-permissions-request\"\n      ></button>\n    </div>\n    <button type=\"button\" class=\"shot-btn\" set=\"onclick: onShot; @disabled: shotBtnDisabled\">\n      <lr-icon name=\"camera\"></lr-icon>\n    </button>\n  </div>\n`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}