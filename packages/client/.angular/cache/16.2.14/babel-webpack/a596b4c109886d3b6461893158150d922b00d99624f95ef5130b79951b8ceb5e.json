{"ast":null,"code":"import { BaseComponent } from '@symbiotejs/symbiote';\nimport { applyTemplateData } from '../../utils/template-utils.js';\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl } from '../../utils/cdn-utils.js';\nimport { PROPS_MAP } from './props-map.js';\nimport { stringToArray } from '../../utils/stringToArray.js';\nimport { uniqueArray } from '../../utils/uniqueArray.js';\nconst CSS_PREF = '--lr-img-';\nconst UNRESOLVED_ATTR = 'unresolved';\nconst HI_RES_K = 2;\nconst ULTRA_RES_K = 3;\nconst DEV_MODE = !window.location.host.trim() || window.location.host.includes(':') || window.location.hostname.includes('localhost');\nconst CSS_PROPS = Object.create(null);\nfor (let prop in PROPS_MAP) {\n  CSS_PROPS[CSS_PREF + prop] = PROPS_MAP[prop]?.default || '';\n}\nexport class ImgBase extends BaseComponent {\n  cssInit$ = CSS_PROPS;\n\n  /**\n   * @param {String} key\n   * @returns {any}\n   */\n  $$(key) {\n    return this.$[CSS_PREF + key];\n  }\n\n  /** @param {Object<String, String | Number>} kvObj */\n  set$$(kvObj) {\n    for (let key in kvObj) {\n      this.$[CSS_PREF + key] = kvObj[key];\n    }\n  }\n\n  /**\n   * @param {String} key\n   * @param {(val: any) => void} kbFn\n   */\n  sub$$(key, kbFn) {\n    this.sub(CSS_PREF + key, val => {\n      // null comes from CSS context property\n      // empty string comes from attribute value\n      if (val === null || val === '') {\n        return;\n      }\n      kbFn(val);\n    });\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   */\n  _fmtAbs(src) {\n    let isRel = !src.includes('//');\n    if (isRel && !DEV_MODE) {\n      src = new URL(src, document.baseURI).href;\n    }\n    return src;\n  }\n\n  /**\n   * Image operations\n   *\n   * @param {String} [size]\n   */\n  _getCdnModifiers(size = '') {\n    return createCdnUrlModifiers(\n    //\n    size && `resize/${size}`, this.$$('cdn-operations') || '', `format/${this.$$('format') || PROPS_MAP.format.default}`, `quality/${this.$$('quality') || PROPS_MAP.quality.default}`);\n  }\n\n  /**\n   * @private\n   * @param {String} size\n   * @returns {any}\n   */\n  _getUrlBase(size = '') {\n    if (this.$$('src').startsWith('data:') || this.$$('src').startsWith('blob:')) {\n      return this.$$('src');\n    }\n\n    // Localhost + relative image path (DO NOTHING):\n    if (DEV_MODE && this.$$('src') && !this.$$('src').includes('//')) {\n      return this._proxyUrl(this.$$('src'));\n    }\n    let cdnModifiers = this._getCdnModifiers(size);\n    if (this.$$('src').startsWith(this.$$('cdn-cname'))) {\n      return createCdnUrl(this.$$('src'), cdnModifiers);\n    }\n\n    // Alternative CDN name:\n    if (this.$$('cdn-cname') && this.$$('uuid')) {\n      return this._proxyUrl(createCdnUrl(\n      //\n      createOriginalUrl(this.$$('cdn-cname'), this.$$('uuid')), cdnModifiers));\n    }\n\n    // UUID only:\n    if (this.$$('uuid')) {\n      return this._proxyUrl(createCdnUrl(\n      //\n      createOriginalUrl(this.$$('cdn-cname'), this.$$('uuid')), cdnModifiers));\n    }\n\n    // Alternative proxy name:\n    if (this.$$('proxy-cname')) {\n      return this._proxyUrl(createCdnUrl(\n      //\n      this.$$('proxy-cname'), cdnModifiers, this._fmtAbs(this.$$('src'))));\n    }\n\n    // Project pubkey only:\n    if (this.$$('pubkey')) {\n      return this._proxyUrl(createCdnUrl(\n      //\n      `https://${this.$$('pubkey')}.ucr.io/`, cdnModifiers, this._fmtAbs(this.$$('src'))));\n    }\n  }\n\n  /**\n   * @private\n   * @param {String} url\n   * @returns {String}\n   */\n  _proxyUrl(url) {\n    let previewProxy = this.$$('secure-delivery-proxy');\n    if (!previewProxy) {\n      return url;\n    }\n    return applyTemplateData(this.$$('secure-delivery-proxy'), {\n      previewUrl: url\n    }, {\n      transform: value => window.encodeURIComponent(value)\n    });\n  }\n\n  /**\n   * @param {HTMLElement} el\n   * @param {Number} [k]\n   * @param {Boolean} [wOnly]\n   */\n  _getElSize(el, k = 1, wOnly = true) {\n    let rect = el.getBoundingClientRect();\n    let w = k * Math.round(rect.width);\n    let h = wOnly ? '' : k * Math.round(rect.height);\n    if (w || h) {\n      return `${w ? w : ''}x${h ? h : ''}`;\n    } else {\n      return null;\n    }\n  }\n\n  /** @param {HTMLImageElement} img */\n  _setupEventProxy(img) {\n    /** @param {Event} e */\n    let proxifyEvent = e => {\n      e.stopPropagation();\n      let event = new Event(e.type, e);\n      this.dispatchEvent(event);\n    };\n    let EVENTS = ['load', 'error'];\n    for (let event of EVENTS) {\n      img.addEventListener(event, proxifyEvent);\n    }\n  }\n\n  /** @type {HTMLImageElement} */\n  get img() {\n    if (!this._img) {\n      /** @private */\n      this._img = new Image();\n      this._setupEventProxy(this.img);\n      this._img.setAttribute(UNRESOLVED_ATTR, '');\n      this.img.onload = () => {\n        this.img.removeAttribute(UNRESOLVED_ATTR);\n      };\n      this.initAttributes();\n      this.appendChild(this._img);\n    }\n    return this._img;\n  }\n  get bgSelector() {\n    return this.$$('is-background-for');\n  }\n  initAttributes() {\n    [...this.attributes].forEach(attr => {\n      if (!PROPS_MAP[attr.name]) {\n        this.img.setAttribute(attr.name, attr.value);\n      }\n    });\n  }\n  get breakpoints() {\n    if (this.$$('breakpoints')) {\n      return uniqueArray(stringToArray(this.$$('breakpoints')).map(str => Number(str)));\n    } else {\n      return null;\n    }\n  }\n\n  /** @param {HTMLElement} el */\n  renderBg(el) {\n    let imgSet = new Set();\n    if (this.breakpoints) {\n      this.breakpoints.forEach(bp => {\n        imgSet.add(`url(\"${this._getUrlBase(bp + 'x')}\") ${bp}w`);\n        if (this.$$('hi-res-support')) {\n          imgSet.add(`url(\"${this._getUrlBase(bp * HI_RES_K + 'x')}\") ${bp * HI_RES_K}w`);\n        }\n        if (this.$$('ultra-res-support')) {\n          imgSet.add(`url(\"${this._getUrlBase(bp * ULTRA_RES_K + 'x')}\") ${bp * ULTRA_RES_K}w`);\n        }\n      });\n    } else {\n      imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el))}\") 1x`);\n      if (this.$$('hi-res-support')) {\n        imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el, HI_RES_K))}\") ${HI_RES_K}x`);\n      }\n      if (this.$$('ultra-res-support')) {\n        imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el, ULTRA_RES_K))}\") ${ULTRA_RES_K}x`);\n      }\n    }\n    let iSet = `image-set(${[...imgSet].join(', ')})`;\n    el.style.setProperty('background-image', iSet);\n    el.style.setProperty('background-image', '-webkit-' + iSet);\n  }\n  getSrcset() {\n    let srcset = new Set();\n    if (this.breakpoints) {\n      this.breakpoints.forEach(bp => {\n        srcset.add(this._getUrlBase(bp + 'x') + ` ${bp}w`);\n        if (this.$$('hi-res-support')) {\n          srcset.add(this._getUrlBase(bp * HI_RES_K + 'x') + ` ${bp * HI_RES_K}w`);\n        }\n        if (this.$$('ultra-res-support')) {\n          srcset.add(this._getUrlBase(bp * ULTRA_RES_K + 'x') + ` ${bp * ULTRA_RES_K}w`);\n        }\n      });\n    } else {\n      srcset.add(this._getUrlBase(this._getElSize(this.img)) + ' 1x');\n      if (this.$$('hi-res-support')) {\n        srcset.add(this._getUrlBase(this._getElSize(this.img, 2)) + ' 2x');\n      }\n      if (this.$$('ultra-res-support')) {\n        srcset.add(this._getUrlBase(this._getElSize(this.img, 3)) + ' 3x');\n      }\n    }\n    return [...srcset].join();\n  }\n  getSrc() {\n    return this._getUrlBase();\n  }\n  init() {\n    if (this.bgSelector) {\n      [...document.querySelectorAll(this.bgSelector)].forEach(el => {\n        if (this.$$('intersection')) {\n          this.initIntersection(el, () => {\n            this.renderBg(el);\n          });\n        } else {\n          this.renderBg(el);\n        }\n      });\n    } else if (this.$$('intersection')) {\n      this.initIntersection(this.img, () => {\n        this.img.srcset = this.getSrcset();\n        this.img.src = this.getSrc();\n      });\n    } else {\n      this.img.srcset = this.getSrcset();\n      this.img.src = this.getSrc();\n    }\n  }\n\n  /**\n   * @param {HTMLElement} el\n   * @param {() => void} cbkFn\n   */\n  initIntersection(el, cbkFn) {\n    let opts = {\n      root: null,\n      rootMargin: '0px'\n    };\n    /** @private */\n    this._isnObserver = new IntersectionObserver(entries => {\n      entries.forEach(ent => {\n        if (ent.isIntersecting) {\n          cbkFn();\n          this._isnObserver.unobserve(el);\n        }\n      });\n    }, opts);\n    this._isnObserver.observe(el);\n    if (!this._observed) {\n      /** @private */\n      this._observed = new Set();\n    }\n    this._observed.add(el);\n  }\n  destroyCallback() {\n    super.destroyCallback();\n    if (this._isnObserver) {\n      this._observed.forEach(el => {\n        this._isnObserver.unobserve(el);\n      });\n      this._isnObserver = null;\n    }\n  }\n  static get observedAttributes() {\n    return Object.keys(PROPS_MAP);\n  }\n  attributeChangedCallback(name, oldVal, newVal) {\n    window.setTimeout(() => {\n      this.$[CSS_PREF + name] = newVal;\n    });\n  }\n}","map":{"version":3,"names":["BaseComponent","applyTemplateData","createCdnUrl","createCdnUrlModifiers","createOriginalUrl","PROPS_MAP","stringToArray","uniqueArray","CSS_PREF","UNRESOLVED_ATTR","HI_RES_K","ULTRA_RES_K","DEV_MODE","window","location","host","trim","includes","hostname","CSS_PROPS","Object","create","prop","default","ImgBase","cssInit$","$$","key","$","set$$","kvObj","sub$$","kbFn","sub","val","_fmtAbs","src","isRel","URL","document","baseURI","href","_getCdnModifiers","size","format","quality","_getUrlBase","startsWith","_proxyUrl","cdnModifiers","url","previewProxy","previewUrl","transform","value","encodeURIComponent","_getElSize","el","k","wOnly","rect","getBoundingClientRect","w","Math","round","width","h","height","_setupEventProxy","img","proxifyEvent","e","stopPropagation","event","Event","type","dispatchEvent","EVENTS","addEventListener","_img","Image","setAttribute","onload","removeAttribute","initAttributes","appendChild","bgSelector","attributes","forEach","attr","name","breakpoints","map","str","Number","renderBg","imgSet","Set","bp","add","iSet","join","style","setProperty","getSrcset","srcset","getSrc","init","querySelectorAll","initIntersection","cbkFn","opts","root","rootMargin","_isnObserver","IntersectionObserver","entries","ent","isIntersecting","unobserve","observe","_observed","destroyCallback","observedAttributes","keys","attributeChangedCallback","oldVal","newVal","setTimeout"],"sources":["/Users/David/Documents/own_projects/mp4-to-gif/node_modules/@uploadcare/blocks/blocks/Img/ImgBase.js"],"sourcesContent":["import { BaseComponent } from '@symbiotejs/symbiote';\nimport { applyTemplateData } from '../../utils/template-utils.js';\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl } from '../../utils/cdn-utils.js';\nimport { PROPS_MAP } from './props-map.js';\nimport { stringToArray } from '../../utils/stringToArray.js';\nimport { uniqueArray } from '../../utils/uniqueArray.js';\n\nconst CSS_PREF = '--lr-img-';\nconst UNRESOLVED_ATTR = 'unresolved';\nconst HI_RES_K = 2;\nconst ULTRA_RES_K = 3;\nconst DEV_MODE =\n  !window.location.host.trim() || window.location.host.includes(':') || window.location.hostname.includes('localhost');\n\nconst CSS_PROPS = Object.create(null);\nfor (let prop in PROPS_MAP) {\n  CSS_PROPS[CSS_PREF + prop] = PROPS_MAP[prop]?.default || '';\n}\n\nexport class ImgBase extends BaseComponent {\n  cssInit$ = CSS_PROPS;\n\n  /**\n   * @param {String} key\n   * @returns {any}\n   */\n  $$(key) {\n    return this.$[CSS_PREF + key];\n  }\n\n  /** @param {Object<String, String | Number>} kvObj */\n  set$$(kvObj) {\n    for (let key in kvObj) {\n      this.$[CSS_PREF + key] = kvObj[key];\n    }\n  }\n\n  /**\n   * @param {String} key\n   * @param {(val: any) => void} kbFn\n   */\n  sub$$(key, kbFn) {\n    this.sub(CSS_PREF + key, (val) => {\n      // null comes from CSS context property\n      // empty string comes from attribute value\n      if (val === null || val === '') {\n        return;\n      }\n      kbFn(val);\n    });\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   */\n  _fmtAbs(src) {\n    let isRel = !src.includes('//');\n    if (isRel && !DEV_MODE) {\n      src = new URL(src, document.baseURI).href;\n    }\n    return src;\n  }\n\n  /**\n   * Image operations\n   *\n   * @param {String} [size]\n   */\n  _getCdnModifiers(size = '') {\n    return createCdnUrlModifiers(\n      //\n      size && `resize/${size}`,\n      this.$$('cdn-operations') || '',\n      `format/${this.$$('format') || PROPS_MAP.format.default}`,\n      `quality/${this.$$('quality') || PROPS_MAP.quality.default}`\n    );\n  }\n\n  /**\n   * @private\n   * @param {String} size\n   * @returns {any}\n   */\n  _getUrlBase(size = '') {\n    if (this.$$('src').startsWith('data:') || this.$$('src').startsWith('blob:')) {\n      return this.$$('src');\n    }\n\n    // Localhost + relative image path (DO NOTHING):\n    if (DEV_MODE && this.$$('src') && !this.$$('src').includes('//')) {\n      return this._proxyUrl(this.$$('src'));\n    }\n\n    let cdnModifiers = this._getCdnModifiers(size);\n\n    if (this.$$('src').startsWith(this.$$('cdn-cname'))) {\n      return createCdnUrl(this.$$('src'), cdnModifiers);\n    }\n\n    // Alternative CDN name:\n    if (this.$$('cdn-cname') && this.$$('uuid')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          createOriginalUrl(this.$$('cdn-cname'), this.$$('uuid')),\n          cdnModifiers\n        )\n      );\n    }\n\n    // UUID only:\n    if (this.$$('uuid')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          createOriginalUrl(this.$$('cdn-cname'), this.$$('uuid')),\n          cdnModifiers\n        )\n      );\n    }\n\n    // Alternative proxy name:\n    if (this.$$('proxy-cname')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          this.$$('proxy-cname'),\n          cdnModifiers,\n          this._fmtAbs(this.$$('src'))\n        )\n      );\n    }\n\n    // Project pubkey only:\n    if (this.$$('pubkey')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          `https://${this.$$('pubkey')}.ucr.io/`,\n          cdnModifiers,\n          this._fmtAbs(this.$$('src'))\n        )\n      );\n    }\n  }\n\n  /**\n   * @private\n   * @param {String} url\n   * @returns {String}\n   */\n  _proxyUrl(url) {\n    let previewProxy = this.$$('secure-delivery-proxy');\n    if (!previewProxy) {\n      return url;\n    }\n    return applyTemplateData(\n      this.$$('secure-delivery-proxy'),\n      { previewUrl: url },\n      { transform: (value) => window.encodeURIComponent(value) }\n    );\n  }\n\n  /**\n   * @param {HTMLElement} el\n   * @param {Number} [k]\n   * @param {Boolean} [wOnly]\n   */\n  _getElSize(el, k = 1, wOnly = true) {\n    let rect = el.getBoundingClientRect();\n    let w = k * Math.round(rect.width);\n    let h = wOnly ? '' : k * Math.round(rect.height);\n    if (w || h) {\n      return `${w ? w : ''}x${h ? h : ''}`;\n    } else {\n      return null;\n    }\n  }\n\n  /** @param {HTMLImageElement} img */\n  _setupEventProxy(img) {\n    /** @param {Event} e */\n    let proxifyEvent = (e) => {\n      e.stopPropagation();\n      let event = new Event(e.type, e);\n      this.dispatchEvent(event);\n    };\n    let EVENTS = ['load', 'error'];\n    for (let event of EVENTS) {\n      img.addEventListener(event, proxifyEvent);\n    }\n  }\n\n  /** @type {HTMLImageElement} */\n  get img() {\n    if (!this._img) {\n      /** @private */\n      this._img = new Image();\n      this._setupEventProxy(this.img);\n      this._img.setAttribute(UNRESOLVED_ATTR, '');\n      this.img.onload = () => {\n        this.img.removeAttribute(UNRESOLVED_ATTR);\n      };\n      this.initAttributes();\n      this.appendChild(this._img);\n    }\n    return this._img;\n  }\n\n  get bgSelector() {\n    return this.$$('is-background-for');\n  }\n\n  initAttributes() {\n    [...this.attributes].forEach((attr) => {\n      if (!PROPS_MAP[attr.name]) {\n        this.img.setAttribute(attr.name, attr.value);\n      }\n    });\n  }\n\n  get breakpoints() {\n    if (this.$$('breakpoints')) {\n      return uniqueArray(stringToArray(this.$$('breakpoints')).map((str) => Number(str)));\n    } else {\n      return null;\n    }\n  }\n\n  /** @param {HTMLElement} el */\n  renderBg(el) {\n    let imgSet = new Set();\n    if (this.breakpoints) {\n      this.breakpoints.forEach((bp) => {\n        imgSet.add(`url(\"${this._getUrlBase(bp + 'x')}\") ${bp}w`);\n        if (this.$$('hi-res-support')) {\n          imgSet.add(`url(\"${this._getUrlBase(bp * HI_RES_K + 'x')}\") ${bp * HI_RES_K}w`);\n        }\n        if (this.$$('ultra-res-support')) {\n          imgSet.add(`url(\"${this._getUrlBase(bp * ULTRA_RES_K + 'x')}\") ${bp * ULTRA_RES_K}w`);\n        }\n      });\n    } else {\n      imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el))}\") 1x`);\n      if (this.$$('hi-res-support')) {\n        imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el, HI_RES_K))}\") ${HI_RES_K}x`);\n      }\n      if (this.$$('ultra-res-support')) {\n        imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el, ULTRA_RES_K))}\") ${ULTRA_RES_K}x`);\n      }\n    }\n    let iSet = `image-set(${[...imgSet].join(', ')})`;\n    el.style.setProperty('background-image', iSet);\n    el.style.setProperty('background-image', '-webkit-' + iSet);\n  }\n\n  getSrcset() {\n    let srcset = new Set();\n    if (this.breakpoints) {\n      this.breakpoints.forEach((bp) => {\n        srcset.add(this._getUrlBase(bp + 'x') + ` ${bp}w`);\n        if (this.$$('hi-res-support')) {\n          srcset.add(this._getUrlBase(bp * HI_RES_K + 'x') + ` ${bp * HI_RES_K}w`);\n        }\n        if (this.$$('ultra-res-support')) {\n          srcset.add(this._getUrlBase(bp * ULTRA_RES_K + 'x') + ` ${bp * ULTRA_RES_K}w`);\n        }\n      });\n    } else {\n      srcset.add(this._getUrlBase(this._getElSize(this.img)) + ' 1x');\n      if (this.$$('hi-res-support')) {\n        srcset.add(this._getUrlBase(this._getElSize(this.img, 2)) + ' 2x');\n      }\n      if (this.$$('ultra-res-support')) {\n        srcset.add(this._getUrlBase(this._getElSize(this.img, 3)) + ' 3x');\n      }\n    }\n    return [...srcset].join();\n  }\n\n  getSrc() {\n    return this._getUrlBase();\n  }\n\n  init() {\n    if (this.bgSelector) {\n      [...document.querySelectorAll(this.bgSelector)].forEach((el) => {\n        if (this.$$('intersection')) {\n          this.initIntersection(el, () => {\n            this.renderBg(el);\n          });\n        } else {\n          this.renderBg(el);\n        }\n      });\n    } else if (this.$$('intersection')) {\n      this.initIntersection(this.img, () => {\n        this.img.srcset = this.getSrcset();\n        this.img.src = this.getSrc();\n      });\n    } else {\n      this.img.srcset = this.getSrcset();\n      this.img.src = this.getSrc();\n    }\n  }\n\n  /**\n   * @param {HTMLElement} el\n   * @param {() => void} cbkFn\n   */\n  initIntersection(el, cbkFn) {\n    let opts = {\n      root: null,\n      rootMargin: '0px',\n    };\n    /** @private */\n    this._isnObserver = new IntersectionObserver((entries) => {\n      entries.forEach((ent) => {\n        if (ent.isIntersecting) {\n          cbkFn();\n          this._isnObserver.unobserve(el);\n        }\n      });\n    }, opts);\n    this._isnObserver.observe(el);\n    if (!this._observed) {\n      /** @private */\n      this._observed = new Set();\n    }\n    this._observed.add(el);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    if (this._isnObserver) {\n      this._observed.forEach((el) => {\n        this._isnObserver.unobserve(el);\n      });\n      this._isnObserver = null;\n    }\n  }\n\n  static get observedAttributes() {\n    return Object.keys(PROPS_MAP);\n  }\n\n  attributeChangedCallback(name, oldVal, newVal) {\n    window.setTimeout(() => {\n      this.$[CSS_PREF + name] = newVal;\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}