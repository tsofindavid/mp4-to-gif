{"ast":null,"code":"import _asyncToGenerator from \"/Users/David/Documents/own_projects/mp4-to-gif/packages/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Block } from '../../../abstract/Block.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { linspace } from './lib/linspace.js';\nimport { batchPreloadImages } from './lib/preloadImage.js';\nimport { COLOR_OPERATIONS_CONFIG } from './toolbar-constants.js';\nimport { viewerImageSrc } from './util.js';\n\n/**\n * @param {Number[]} numbers\n * @returns {[Number, Number][]}\n */\nfunction splitBySections(numbers) {\n  return numbers.reduce((acc, point, idx) => idx < numbers.length - 1 ? [...acc, [point, numbers[idx + 1]]] : acc, []);\n}\n\n/**\n * @param {Number[]} keypoints\n * @param {Number} value\n * @param {Number} zero\n */\nfunction calculateOpacities(keypoints, value, zero) {\n  let section = splitBySections(keypoints).find(([left, right]) => left <= value && value <= right);\n  return keypoints.map(point => {\n    let distance = Math.abs(section[0] - section[1]);\n    let relation = Math.abs(value - section[0]) / distance;\n    if (section[0] === point) {\n      return value > zero ? 1 : 1 - relation;\n    }\n    if (section[1] === point) {\n      return value >= zero ? relation : 1;\n    }\n    return 0;\n  });\n}\n\n/**\n * @param {Number[]} keypoints\n * @param {Number} zero\n */\nfunction calculateZIndices(keypoints, zero) {\n  return keypoints.map((point, idx) => point < zero ? keypoints.length - idx : idx);\n}\n\n/**\n * @param {String} operation\n * @param {Number} value\n * @returns {Number[]}\n */\nfunction keypointsRange(operation, value) {\n  let n = COLOR_OPERATIONS_CONFIG[operation].keypointsNumber;\n  let {\n    range,\n    zero\n  } = COLOR_OPERATIONS_CONFIG[operation];\n  return [...new Set([...linspace(range[0], zero, n + 1), ...linspace(zero, range[1], n + 1), zero, value])].sort((a, b) => a - b);\n}\n\n/**\n * @typedef {Object} Keypoint\n * @property {String} src\n * @property {Number} opacity\n * @property {Number} zIndex\n * @property {HTMLImageElement} image\n * @property {Number} value\n */\n\nexport class EditorImageFader extends Block {\n  constructor() {\n    super();\n\n    /**\n     * @private\n     * @type {Boolean}\n     */\n    this._isActive = false;\n\n    /**\n     * @private\n     * @type {Boolean}\n     */\n    this._hidden = true;\n\n    /** @private */\n    this._addKeypointDebounced = debounce(this._addKeypoint.bind(this), 600);\n    this.classList.add('inactive_to_cropper');\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   * @returns {() => void} Destructor\n   */\n  _handleImageLoading(src) {\n    let operation = this._operation;\n    let loadingOperations = this.$['*loadingOperations'];\n    if (!loadingOperations.get(operation)) {\n      loadingOperations.set(operation, new Map());\n    }\n    if (!loadingOperations.get(operation).get(src)) {\n      loadingOperations.set(operation, loadingOperations.get(operation).set(src, true));\n      this.$['*loadingOperations'] = loadingOperations;\n    }\n    return () => {\n      if (loadingOperations?.get(operation)?.has(src)) {\n        loadingOperations.get(operation).delete(src);\n        this.$['*loadingOperations'] = loadingOperations;\n      }\n    };\n  }\n\n  /** @private */\n  _flush() {\n    window.cancelAnimationFrame(this._raf);\n    this._raf = window.requestAnimationFrame(() => {\n      for (let kp of this._keypoints) {\n        let {\n          image\n        } = kp;\n        if (image) {\n          image.style.opacity = kp.opacity.toString();\n          image.style.zIndex = kp.zIndex.toString();\n        }\n      }\n    });\n  }\n\n  /**\n   * @private\n   * @param {Object} options\n   * @param {String} [options.url]\n   * @param {String} [options.filter]\n   * @param {String} [options.operation]\n   * @param {Number} [options.value]\n   * @returns {String}\n   */\n  _imageSrc({\n    url = this._url,\n    filter = this._filter,\n    operation,\n    value\n  } = {}) {\n    let transformations = {\n      ...this._transformations\n    };\n    if (operation) {\n      transformations[operation] = filter ? {\n        name: filter,\n        amount: value\n      } : value;\n    }\n\n    // do not use getBoundingClientRect because scale transform affects it\n    let width = this.offsetWidth;\n    return this.proxyUrl(viewerImageSrc(url, width, transformations));\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {Number} value\n   * @returns {Keypoint}\n   */\n  _constructKeypoint(operation, value) {\n    let src = this._imageSrc({\n      operation,\n      value\n    });\n    return {\n      src,\n      image: null,\n      opacity: 0,\n      zIndex: 0,\n      value\n    };\n  }\n\n  /**\n   * Check if current operation and filter equals passed ones\n   *\n   * @private\n   * @param {String} operation\n   * @param {String} [filter]\n   * @returns {Boolean}\n   */\n  _isSame(operation, filter) {\n    return this._operation === operation && this._filter === filter;\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {String | null} filter\n   * @param {Number} value\n   */\n  _addKeypoint(operation, filter, value) {\n    let shouldSkip = () => !this._isSame(operation, filter) || this._value !== value || !!this._keypoints.find(kp => kp.value === value);\n    if (shouldSkip()) {\n      return;\n    }\n    let keypoint = this._constructKeypoint(operation, value);\n    let image = new Image();\n    image.src = keypoint.src;\n    let stop = this._handleImageLoading(keypoint.src);\n    image.addEventListener('load', stop, {\n      once: true\n    });\n    image.addEventListener('error', stop, {\n      once: true\n    });\n    keypoint.image = image;\n    image.classList.add('fader-image');\n    image.addEventListener('load', () => {\n      if (shouldSkip()) {\n        return;\n      }\n      let keypoints = this._keypoints;\n      let idx = keypoints.findIndex(kp => kp.value > value);\n      let insertBeforeNode = idx < keypoints.length ? keypoints[idx].image : null;\n      if (!this._container || insertBeforeNode && !this._container.contains(insertBeforeNode)) {\n        return;\n      }\n      keypoints.splice(idx, 0, keypoint);\n      this._container.insertBefore(image, insertBeforeNode);\n      this._update(operation, value);\n    }, {\n      once: true\n    });\n    image.addEventListener('error', () => {\n      this.$['*networkProblems'] = true;\n    }, {\n      once: true\n    });\n  }\n\n  /** @param {String | Number} value */\n  set(value) {\n    value = typeof value === 'string' ? parseInt(value, 10) : value;\n    this._update(this._operation, value);\n    this._addKeypointDebounced(this._operation, this._filter, value);\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {Number} value\n   */\n  _update(operation, value) {\n    this._operation = operation;\n    this._value = value;\n    let {\n      zero\n    } = COLOR_OPERATIONS_CONFIG[operation];\n    let keypointValues = this._keypoints.map(kp => kp.value);\n    let opacities = calculateOpacities(keypointValues, value, zero);\n    let zIndices = calculateZIndices(keypointValues, zero);\n    for (let [idx, kp] of Object.entries(this._keypoints)) {\n      kp.opacity = opacities[idx];\n      kp.zIndex = zIndices[idx];\n    }\n    this._flush();\n  }\n\n  /** @private */\n  _createPreviewImage() {\n    let image = new Image();\n    image.classList.add('fader-image', 'fader-image--preview');\n    image.style.opacity = '0';\n    return image;\n  }\n\n  /** @private */\n  _initNodes() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let fr = document.createDocumentFragment();\n      _this._previewImage = _this._previewImage || _this._createPreviewImage();\n      !_this.contains(_this._previewImage) && fr.appendChild(_this._previewImage);\n      let container = document.createElement('div');\n      fr.appendChild(container);\n      let srcList = _this._keypoints.map(kp => kp.src);\n      let {\n        images,\n        promise,\n        cancel\n      } = batchPreloadImages(srcList);\n      images.forEach(node => {\n        let stop = _this._handleImageLoading(node.src);\n        node.addEventListener('load', stop);\n        node.addEventListener('error', stop);\n      });\n      _this._cancelLastImages = () => {\n        cancel();\n        _this._cancelLastImages = undefined;\n      };\n      let operation = _this._operation;\n      let filter = _this._filter;\n      yield promise;\n      if (_this._isActive && _this._isSame(operation, filter)) {\n        _this._container && _this._container.remove();\n        _this._container = container;\n        _this._keypoints.forEach((kp, idx) => {\n          let kpImage = images[idx];\n          kpImage.classList.add('fader-image');\n          kp.image = kpImage;\n          _this._container.appendChild(kpImage);\n        });\n        _this.appendChild(fr);\n        _this._flush();\n      }\n    })();\n  }\n\n  /** @param {import('./types.js').Transformations} transformations */\n  setTransformations(transformations) {\n    this._transformations = transformations;\n    if (this._previewImage) {\n      let src = this._imageSrc();\n      let stop = this._handleImageLoading(src);\n      this._previewImage.src = src;\n      this._previewImage.addEventListener('load', stop, {\n        once: true\n      });\n      this._previewImage.addEventListener('error', stop, {\n        once: true\n      });\n      this._previewImage.style.opacity = '1';\n      this._previewImage.addEventListener('error', () => {\n        this.$['*networkProblems'] = true;\n      }, {\n        once: true\n      });\n    }\n  }\n\n  /**\n   * @param {object} options\n   * @param {String} options.url\n   * @param {String} options.operation\n   * @param {Number} options.value\n   * @param {String} [options.filter]\n   */\n  preload({\n    url,\n    filter,\n    operation,\n    value\n  }) {\n    this._cancelBatchPreload && this._cancelBatchPreload();\n    let keypoints = keypointsRange(operation, value);\n    let srcList = keypoints.map(kp => this._imageSrc({\n      url,\n      filter,\n      operation,\n      value: kp\n    }));\n    let {\n      cancel\n    } = batchPreloadImages(srcList);\n    this._cancelBatchPreload = cancel;\n  }\n\n  /** @private */\n  _setOriginalSrc(src) {\n    let image = this._previewImage || this._createPreviewImage();\n    !this.contains(image) && this.appendChild(image);\n    this._previewImage = image;\n    if (image.src === src) {\n      image.style.opacity = '1';\n      image.style.transform = 'scale(1)';\n      this.className = classNames({\n        active_from_viewer: this._fromViewer,\n        active_from_cropper: !this._fromViewer,\n        inactive_to_cropper: false\n      });\n      return;\n    }\n    image.style.opacity = '0';\n    let stop = this._handleImageLoading(src);\n    image.addEventListener('error', stop, {\n      once: true\n    });\n    image.src = src;\n    image.addEventListener('load', () => {\n      stop();\n      if (image) {\n        image.style.opacity = '1';\n        image.style.transform = 'scale(1)';\n        this.className = classNames({\n          active_from_viewer: this._fromViewer,\n          active_from_cropper: !this._fromViewer,\n          inactive_to_cropper: false\n        });\n      }\n    }, {\n      once: true\n    });\n    image.addEventListener('error', () => {\n      this.$['*networkProblems'] = true;\n    }, {\n      once: true\n    });\n  }\n\n  /**\n   * @param {object} options\n   * @param {String} options.url\n   * @param {String} [options.operation]\n   * @param {Number} [options.value]\n   * @param {String} [options.filter]\n   * @param {Boolean} [options.fromViewer]\n   */\n  activate({\n    url,\n    operation,\n    value,\n    filter,\n    fromViewer\n  }) {\n    this._isActive = true;\n    this._hidden = false;\n    this._url = url;\n    this._operation = operation || 'initial';\n    this._value = value;\n    this._filter = filter;\n    this._fromViewer = fromViewer;\n    let isOriginal = typeof value !== 'number' && !filter;\n    if (isOriginal) {\n      let src = this._imageSrc({\n        operation,\n        value\n      });\n      this._setOriginalSrc(src);\n      this._container && this._container.remove();\n      return;\n    }\n    this._keypoints = keypointsRange(operation, value).map(keyValue => this._constructKeypoint(operation, keyValue));\n    this._update(operation, value);\n    this._initNodes();\n  }\n\n  /** @param {{ hide?: Boolean }} options */\n  deactivate({\n    hide = true\n  } = {}) {\n    this._isActive = false;\n    this._cancelLastImages && this._cancelLastImages();\n    this._cancelBatchPreload && this._cancelBatchPreload();\n    if (hide && !this._hidden) {\n      this._hidden = true;\n      if (this._previewImage) {\n        this._previewImage.style.transform = 'scale(1)';\n      }\n      this.className = classNames({\n        active_from_viewer: false,\n        active_from_cropper: false,\n        inactive_to_cropper: true\n      });\n      this.addEventListener('transitionend', () => {\n        this._container && this._container.remove();\n      }, {\n        once: true\n      });\n    } else {\n      this._container && this._container.remove();\n    }\n  }\n}","map":{"version":3,"names":["Block","classNames","debounce","linspace","batchPreloadImages","COLOR_OPERATIONS_CONFIG","viewerImageSrc","splitBySections","numbers","reduce","acc","point","idx","length","calculateOpacities","keypoints","value","zero","section","find","left","right","map","distance","Math","abs","relation","calculateZIndices","keypointsRange","operation","n","keypointsNumber","range","Set","sort","a","b","EditorImageFader","constructor","_isActive","_hidden","_addKeypointDebounced","_addKeypoint","bind","classList","add","_handleImageLoading","src","_operation","loadingOperations","$","get","set","Map","has","delete","_flush","window","cancelAnimationFrame","_raf","requestAnimationFrame","kp","_keypoints","image","style","opacity","toString","zIndex","_imageSrc","url","_url","filter","_filter","transformations","_transformations","name","amount","width","offsetWidth","proxyUrl","_constructKeypoint","_isSame","shouldSkip","_value","keypoint","Image","stop","addEventListener","once","findIndex","insertBeforeNode","_container","contains","splice","insertBefore","_update","parseInt","keypointValues","opacities","zIndices","Object","entries","_createPreviewImage","_initNodes","_this","_asyncToGenerator","fr","document","createDocumentFragment","_previewImage","appendChild","container","createElement","srcList","images","promise","cancel","forEach","node","_cancelLastImages","undefined","remove","kpImage","setTransformations","preload","_cancelBatchPreload","_setOriginalSrc","transform","className","active_from_viewer","_fromViewer","active_from_cropper","inactive_to_cropper","activate","fromViewer","isOriginal","keyValue","deactivate","hide"],"sources":["/Users/David/Documents/own_projects/mp4-to-gif/node_modules/@uploadcare/blocks/blocks/CloudImageEditor/src/EditorImageFader.js"],"sourcesContent":["import { Block } from '../../../abstract/Block.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { linspace } from './lib/linspace.js';\nimport { batchPreloadImages } from './lib/preloadImage.js';\nimport { COLOR_OPERATIONS_CONFIG } from './toolbar-constants.js';\nimport { viewerImageSrc } from './util.js';\n\n/**\n * @param {Number[]} numbers\n * @returns {[Number, Number][]}\n */\nfunction splitBySections(numbers) {\n  return numbers.reduce(\n    (acc, point, idx) => (idx < numbers.length - 1 ? [...acc, [point, numbers[idx + 1]]] : acc),\n    []\n  );\n}\n\n/**\n * @param {Number[]} keypoints\n * @param {Number} value\n * @param {Number} zero\n */\nfunction calculateOpacities(keypoints, value, zero) {\n  let section = splitBySections(keypoints).find(([left, right]) => left <= value && value <= right);\n  return keypoints.map((point) => {\n    let distance = Math.abs(section[0] - section[1]);\n    let relation = Math.abs(value - section[0]) / distance;\n\n    if (section[0] === point) {\n      return value > zero ? 1 : 1 - relation;\n    }\n    if (section[1] === point) {\n      return value >= zero ? relation : 1;\n    }\n    return 0;\n  });\n}\n\n/**\n * @param {Number[]} keypoints\n * @param {Number} zero\n */\nfunction calculateZIndices(keypoints, zero) {\n  return keypoints.map((point, idx) => (point < zero ? keypoints.length - idx : idx));\n}\n\n/**\n * @param {String} operation\n * @param {Number} value\n * @returns {Number[]}\n */\nfunction keypointsRange(operation, value) {\n  let n = COLOR_OPERATIONS_CONFIG[operation].keypointsNumber;\n  let { range, zero } = COLOR_OPERATIONS_CONFIG[operation];\n\n  return [...new Set([...linspace(range[0], zero, n + 1), ...linspace(zero, range[1], n + 1), zero, value])].sort(\n    (a, b) => a - b\n  );\n}\n\n/**\n * @typedef {Object} Keypoint\n * @property {String} src\n * @property {Number} opacity\n * @property {Number} zIndex\n * @property {HTMLImageElement} image\n * @property {Number} value\n */\n\nexport class EditorImageFader extends Block {\n  constructor() {\n    super();\n\n    /**\n     * @private\n     * @type {Boolean}\n     */\n    this._isActive = false;\n\n    /**\n     * @private\n     * @type {Boolean}\n     */\n    this._hidden = true;\n\n    /** @private */\n    this._addKeypointDebounced = debounce(this._addKeypoint.bind(this), 600);\n\n    this.classList.add('inactive_to_cropper');\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   * @returns {() => void} Destructor\n   */\n  _handleImageLoading(src) {\n    let operation = this._operation;\n\n    let loadingOperations = this.$['*loadingOperations'];\n    if (!loadingOperations.get(operation)) {\n      loadingOperations.set(operation, new Map());\n    }\n\n    if (!loadingOperations.get(operation).get(src)) {\n      loadingOperations.set(operation, loadingOperations.get(operation).set(src, true));\n      this.$['*loadingOperations'] = loadingOperations;\n    }\n\n    return () => {\n      if (loadingOperations?.get(operation)?.has(src)) {\n        loadingOperations.get(operation).delete(src);\n        this.$['*loadingOperations'] = loadingOperations;\n      }\n    };\n  }\n\n  /** @private */\n  _flush() {\n    window.cancelAnimationFrame(this._raf);\n    this._raf = window.requestAnimationFrame(() => {\n      for (let kp of this._keypoints) {\n        let { image } = kp;\n        if (image) {\n          image.style.opacity = kp.opacity.toString();\n          image.style.zIndex = kp.zIndex.toString();\n        }\n      }\n    });\n  }\n\n  /**\n   * @private\n   * @param {Object} options\n   * @param {String} [options.url]\n   * @param {String} [options.filter]\n   * @param {String} [options.operation]\n   * @param {Number} [options.value]\n   * @returns {String}\n   */\n  _imageSrc({ url = this._url, filter = this._filter, operation, value } = {}) {\n    let transformations = { ...this._transformations };\n\n    if (operation) {\n      transformations[operation] = filter ? { name: filter, amount: value } : value;\n    }\n\n    // do not use getBoundingClientRect because scale transform affects it\n    let width = this.offsetWidth;\n    return this.proxyUrl(viewerImageSrc(url, width, transformations));\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {Number} value\n   * @returns {Keypoint}\n   */\n  _constructKeypoint(operation, value) {\n    let src = this._imageSrc({ operation, value });\n    return {\n      src,\n      image: null,\n      opacity: 0,\n      zIndex: 0,\n      value,\n    };\n  }\n\n  /**\n   * Check if current operation and filter equals passed ones\n   *\n   * @private\n   * @param {String} operation\n   * @param {String} [filter]\n   * @returns {Boolean}\n   */\n  _isSame(operation, filter) {\n    return this._operation === operation && this._filter === filter;\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {String | null} filter\n   * @param {Number} value\n   */\n  _addKeypoint(operation, filter, value) {\n    let shouldSkip = () =>\n      !this._isSame(operation, filter) || this._value !== value || !!this._keypoints.find((kp) => kp.value === value);\n\n    if (shouldSkip()) {\n      return;\n    }\n    let keypoint = this._constructKeypoint(operation, value);\n    let image = new Image();\n    image.src = keypoint.src;\n    let stop = this._handleImageLoading(keypoint.src);\n    image.addEventListener('load', stop, { once: true });\n    image.addEventListener('error', stop, { once: true });\n    keypoint.image = image;\n    image.classList.add('fader-image');\n\n    image.addEventListener(\n      'load',\n      () => {\n        if (shouldSkip()) {\n          return;\n        }\n        let keypoints = this._keypoints;\n        let idx = keypoints.findIndex((kp) => kp.value > value);\n        let insertBeforeNode = idx < keypoints.length ? keypoints[idx].image : null;\n        if (!this._container || (insertBeforeNode && !this._container.contains(insertBeforeNode))) {\n          return;\n        }\n        keypoints.splice(idx, 0, keypoint);\n        this._container.insertBefore(image, insertBeforeNode);\n        this._update(operation, value);\n      },\n      { once: true }\n    );\n\n    image.addEventListener(\n      'error',\n      () => {\n        this.$['*networkProblems'] = true;\n      },\n      { once: true }\n    );\n  }\n\n  /** @param {String | Number} value */\n  set(value) {\n    value = typeof value === 'string' ? parseInt(value, 10) : value;\n    this._update(this._operation, value);\n    this._addKeypointDebounced(this._operation, this._filter, value);\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {Number} value\n   */\n  _update(operation, value) {\n    this._operation = operation;\n    this._value = value;\n\n    let { zero } = COLOR_OPERATIONS_CONFIG[operation];\n\n    let keypointValues = this._keypoints.map((kp) => kp.value);\n    let opacities = calculateOpacities(keypointValues, value, zero);\n    let zIndices = calculateZIndices(keypointValues, zero);\n\n    for (let [idx, kp] of Object.entries(this._keypoints)) {\n      kp.opacity = opacities[idx];\n      kp.zIndex = zIndices[idx];\n    }\n\n    this._flush();\n  }\n\n  /** @private */\n  _createPreviewImage() {\n    let image = new Image();\n    image.classList.add('fader-image', 'fader-image--preview');\n    image.style.opacity = '0';\n    return image;\n  }\n\n  /** @private */\n  async _initNodes() {\n    let fr = document.createDocumentFragment();\n    this._previewImage = this._previewImage || this._createPreviewImage();\n    !this.contains(this._previewImage) && fr.appendChild(this._previewImage);\n\n    let container = document.createElement('div');\n    fr.appendChild(container);\n\n    let srcList = this._keypoints.map((kp) => kp.src);\n\n    let { images, promise, cancel } = batchPreloadImages(srcList);\n    images.forEach((node) => {\n      let stop = this._handleImageLoading(node.src);\n      node.addEventListener('load', stop);\n      node.addEventListener('error', stop);\n    });\n    this._cancelLastImages = () => {\n      cancel();\n      this._cancelLastImages = undefined;\n    };\n    let operation = this._operation;\n    let filter = this._filter;\n    await promise;\n    if (this._isActive && this._isSame(operation, filter)) {\n      this._container && this._container.remove();\n      this._container = container;\n      this._keypoints.forEach((kp, idx) => {\n        let kpImage = images[idx];\n        kpImage.classList.add('fader-image');\n        kp.image = kpImage;\n        this._container.appendChild(kpImage);\n      });\n      this.appendChild(fr);\n      this._flush();\n    }\n  }\n\n  /** @param {import('./types.js').Transformations} transformations */\n  setTransformations(transformations) {\n    this._transformations = transformations;\n    if (this._previewImage) {\n      let src = this._imageSrc();\n      let stop = this._handleImageLoading(src);\n      this._previewImage.src = src;\n      this._previewImage.addEventListener('load', stop, { once: true });\n      this._previewImage.addEventListener('error', stop, { once: true });\n      this._previewImage.style.opacity = '1';\n\n      this._previewImage.addEventListener(\n        'error',\n        () => {\n          this.$['*networkProblems'] = true;\n        },\n        { once: true }\n      );\n    }\n  }\n\n  /**\n   * @param {object} options\n   * @param {String} options.url\n   * @param {String} options.operation\n   * @param {Number} options.value\n   * @param {String} [options.filter]\n   */\n  preload({ url, filter, operation, value }) {\n    this._cancelBatchPreload && this._cancelBatchPreload();\n\n    let keypoints = keypointsRange(operation, value);\n    let srcList = keypoints.map((kp) => this._imageSrc({ url, filter, operation, value: kp }));\n    let { cancel } = batchPreloadImages(srcList);\n\n    this._cancelBatchPreload = cancel;\n  }\n\n  /** @private */\n  _setOriginalSrc(src) {\n    let image = this._previewImage || this._createPreviewImage();\n    !this.contains(image) && this.appendChild(image);\n    this._previewImage = image;\n\n    if (image.src === src) {\n      image.style.opacity = '1';\n      image.style.transform = 'scale(1)';\n      this.className = classNames({\n        active_from_viewer: this._fromViewer,\n        active_from_cropper: !this._fromViewer,\n        inactive_to_cropper: false,\n      });\n      return;\n    }\n    image.style.opacity = '0';\n    let stop = this._handleImageLoading(src);\n    image.addEventListener('error', stop, { once: true });\n    image.src = src;\n    image.addEventListener(\n      'load',\n      () => {\n        stop();\n        if (image) {\n          image.style.opacity = '1';\n          image.style.transform = 'scale(1)';\n          this.className = classNames({\n            active_from_viewer: this._fromViewer,\n            active_from_cropper: !this._fromViewer,\n            inactive_to_cropper: false,\n          });\n        }\n      },\n      { once: true }\n    );\n    image.addEventListener(\n      'error',\n      () => {\n        this.$['*networkProblems'] = true;\n      },\n      { once: true }\n    );\n  }\n\n  /**\n   * @param {object} options\n   * @param {String} options.url\n   * @param {String} [options.operation]\n   * @param {Number} [options.value]\n   * @param {String} [options.filter]\n   * @param {Boolean} [options.fromViewer]\n   */\n  activate({ url, operation, value, filter, fromViewer }) {\n    this._isActive = true;\n    this._hidden = false;\n    this._url = url;\n    this._operation = operation || 'initial';\n    this._value = value;\n    this._filter = filter;\n    this._fromViewer = fromViewer;\n\n    let isOriginal = typeof value !== 'number' && !filter;\n    if (isOriginal) {\n      let src = this._imageSrc({ operation, value });\n      this._setOriginalSrc(src);\n      this._container && this._container.remove();\n      return;\n    }\n    this._keypoints = keypointsRange(operation, value).map((keyValue) => this._constructKeypoint(operation, keyValue));\n\n    this._update(operation, value);\n    this._initNodes();\n  }\n\n  /** @param {{ hide?: Boolean }} options */\n  deactivate({ hide = true } = {}) {\n    this._isActive = false;\n\n    this._cancelLastImages && this._cancelLastImages();\n    this._cancelBatchPreload && this._cancelBatchPreload();\n\n    if (hide && !this._hidden) {\n      this._hidden = true;\n      if (this._previewImage) {\n        this._previewImage.style.transform = 'scale(1)';\n      }\n      this.className = classNames({\n        active_from_viewer: false,\n        active_from_cropper: false,\n        inactive_to_cropper: true,\n      });\n      this.addEventListener(\n        'transitionend',\n        () => {\n          this._container && this._container.remove();\n        },\n        { once: true }\n      );\n    } else {\n      this._container && this._container.remove();\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}